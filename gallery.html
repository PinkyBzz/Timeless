<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Galeri — TIMELESS</title>
    <meta name="description" content="Galeri karya fotografi dan videografi Timeless." />
    <link rel="icon" type="image/jpeg" href="timelessbackground.jpeg" />
    
    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Original CSS Link (Preserved) -->
    <link rel="stylesheet" href="assets/css/styles.css" />

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            red: '#DC2626', // red-600
                            black: '#171717', // neutral-900
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Hide scrollbar when modal is open */
        body.modal-open {
            overflow: hidden;
        }
        
        /* Film Grain Effect */
        .film-grain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9998;
            opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
    </style>
    <script>
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            document.documentElement.setAttribute('data-theme', 'dark');
        } else {
            document.documentElement.classList.remove('dark');
            document.documentElement.setAttribute('data-theme', 'light');
        }
    </script>
</head>
<body class="bg-white text-neutral-900 font-sans antialiased selection:bg-red-100 selection:text-red-900 dark:bg-neutral-950 dark:text-white transition-colors duration-300">

    <!-- Film Grain Overlay -->
    <div class="film-grain"></div>

    <!-- Page Loader -->
    <div id="page-loader">
        <div class="loader-content">
            <img src="timelessbackground.jpeg" class="loader-logo" alt="Loading..." />
        </div>
    </div>

    <!-- Custom Cursor -->
    <div class="custom-cursor"></div>
    <div class="cursor-dot"></div>

    <!-- Header -->
    <header class="fixed top-4 left-1/2 -translate-x-1/2 w-[95%] max-w-7xl !z-[999] rounded-full bg-white/70 dark:bg-neutral-950/70 backdrop-blur-xl border border-white/20 dark:border-neutral-800 shadow-lg transition-all duration-300">
        <div class="px-6 h-16 flex justify-between items-center">
            
            <!-- Brand -->
            <a class="flex items-center gap-2.5 group" href="index.html" aria-label="Beranda Timeless">
                <img class="w-10 h-10 rounded-full border border-neutral-200 dark:border-neutral-800 object-cover transition-transform group-hover:scale-105 brand-logo" src="timelessbackground.jpeg" alt="Logo Timeless" />
                <img class="h-7 w-auto object-contain brand-type dark:hidden" src="timelesstype.png" alt="TIMELESS" />
                <img class="h-9 w-auto object-contain brand-type hidden dark:block" src="timelesstype-white.png" alt="TIMELESS" />
            </a>

            <!-- Desktop Menu -->
            <nav class="flex max-md:hidden items-center space-x-8" id="menu-desktop">
                <a href="index.html" class="text-sm font-medium text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Beranda</a>
                <a href="services.html" class="text-sm font-medium text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Layanan</a>
                <a href="gallery.html" class="text-sm font-medium text-red-600 dark:text-red-500 hover:text-red-700 transition-colors">Galeri</a>
                <a href="contact.html" class="text-sm font-medium text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Kontak</a>
                <a href="developer.html" class="text-sm font-medium text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Tentang</a>
            </nav>

            <!-- Mobile Toggle -->
            <div class="md:hidden">
                <button class="group p-2 text-neutral-600 dark:text-neutral-300 hover:text-neutral-900 focus:outline-none" aria-label="Buka menu" id="nav-toggle">
                    <div class="w-6 h-5 relative flex flex-col justify-between">
                        <span class="w-full h-0.5 bg-current rounded-full transition-all duration-300 origin-center group-[.active]:rotate-45 group-[.active]:translate-y-[9px]"></span>
                        <span class="w-full h-0.5 bg-current rounded-full transition-all duration-300 group-[.active]:opacity-0"></span>
                        <span class="w-full h-0.5 bg-current rounded-full transition-all duration-300 origin-center group-[.active]:-rotate-45 group-[.active]:-translate-y-[9px]"></span>
                    </div>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Menu Overlay (Strips Reveal) -->
    <div id="mobile-menu-overlay" class="fixed inset-0 z-[9999] invisible md:hidden">
        <!-- Strips Background -->
        <div class="absolute inset-0 flex h-full w-full pointer-events-none">
            <div class="menu-strip w-1/4 h-full"></div>
            <div class="menu-strip w-1/4 h-full"></div>
            <div class="menu-strip w-1/4 h-full"></div>
            <div class="menu-strip w-1/4 h-full"></div>
        </div>

        <!-- Menu Content -->
        <div class="relative z-10 flex flex-col justify-center items-center h-full menu-content">
            <!-- Close Button -->
            <button id="menu-close-btn" class="absolute top-6 right-6 p-2 text-neutral-900 dark:text-white hover:text-red-600 transition-colors">
                <i data-lucide="x" class="w-8 h-8"></i>
            </button>

            <nav class="flex flex-col items-center space-y-8">
                <a href="index.html" class="mobile-link text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-neutral-900 to-neutral-500 dark:from-white dark:to-neutral-400 hover:to-red-600 transition-all tracking-tight">Beranda</a>
                <a href="services.html" class="mobile-link text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-neutral-900 to-neutral-500 dark:from-white dark:to-neutral-400 hover:to-red-600 transition-all tracking-tight">Layanan</a>
                <a href="gallery.html" class="mobile-link text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-neutral-900 to-neutral-500 dark:from-white dark:to-neutral-400 hover:to-red-600 transition-all tracking-tight">Galeri</a>
                <a href="contact.html" class="mobile-link text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-neutral-900 to-neutral-500 dark:from-white dark:to-neutral-400 hover:to-red-600 transition-all tracking-tight">Kontak</a>
                <a href="developer.html" class="mobile-link text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-b from-neutral-900 to-neutral-500 dark:from-white dark:to-neutral-400 hover:to-red-600 transition-all tracking-tight">Tentang</a>
            </nav>

            <div class="absolute bottom-12 flex gap-8">
                <a href="https://www.instagram.com/timeless.projct/?utm_source=ig_web_button_share_sheet" target="_blank" rel="noopener" class="text-neutral-500 dark:text-neutral-400 hover:text-red-600 dark:hover:text-white transition-colors"><i data-lucide="instagram" class="w-6 h-6"></i></a>
                <a href="https://wa.me/6285183565910?text=Halo%20Timeless%2C%20saya%20tertarik%20dengan%20layanan%20Anda." target="_blank" rel="noopener" class="text-neutral-500 dark:text-neutral-400 hover:text-red-600 dark:hover:text-white transition-colors"><i data-lucide="message-circle" class="w-6 h-6"></i></a>
                <a href="mailto:timelessgacor25@gmail.com?subject=Brief%20Layanan%20Timeless&body=Halo%20Timeless%2C%20saya%20ingin%20mendiskusikan%20kebutuhan%20saya." class="text-neutral-500 dark:text-neutral-400 hover:text-red-600 dark:hover:text-white transition-colors"><i data-lucide="mail" class="w-6 h-6"></i></a>
            </div>
        </div>
    </div>

    <div class="fixed inset-0 bg-black/50 z-40 hidden" id="nav-backdrop"></div>

    <main class="pt-24 lg:pt-32 pb-20">
        
        <!-- Page Header -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16 text-center reveal animate-fade-in">
            <h1 class="text-4xl lg:text-5xl font-bold tracking-tight text-neutral-900 dark:text-white mb-4">Galeri Karya</h1>
            <p class="text-lg text-neutral-500 dark:text-neutral-400 max-w-2xl mx-auto">
                Kumpulan karya terbaik kami yang telah membantu klien mencapai tujuan mereka.
            </p>
        </section>

        <!-- Infinite Marquee -->
        <div class="marquee-container mb-16">
            <div class="marquee-content">
                <span class="marquee-item">Photography</span>
                <span class="marquee-item">Videography</span>
                <span class="marquee-item">Logo Design</span>
                <span class="marquee-item">Timeless Creative</span>
                <span class="marquee-item">Photography</span>
                <span class="marquee-item">Videography</span>
                <span class="marquee-item">Logo Design</span>
                <span class="marquee-item">Timeless Creative</span>
            </div>
        </div>

        <!-- Gallery Grid -->
        <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-24">
            
            <!-- Filter Buttons -->
            <div class="flex flex-wrap justify-center gap-4 mb-12" id="gallery-filters">
                <button class="filter-btn active px-6 py-2 rounded-full border border-red-600 bg-red-600 text-white text-sm font-medium transition-all" data-filter="all">
                    Semua
                </button>
                <button class="filter-btn px-6 py-2 rounded-full border border-neutral-200 dark:border-neutral-800 text-neutral-600 dark:text-neutral-400 hover:border-red-600 hover:text-red-600 text-sm font-medium transition-all" data-filter="fotografi">
                    Fotografi
                </button>
                <button class="filter-btn px-6 py-2 rounded-full border border-neutral-200 dark:border-neutral-800 text-neutral-600 dark:text-neutral-400 hover:border-red-600 hover:text-red-600 text-sm font-medium transition-all" data-filter="videografi">
                    Videografi
                </button>
                <button class="filter-btn px-6 py-2 rounded-full border border-neutral-200 dark:border-neutral-800 text-neutral-600 dark:text-neutral-400 hover:border-red-600 hover:text-red-600 text-sm font-medium transition-all" data-filter="logo">
                    Desain Logo
                </button>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="gallery-grid">
                <!-- Data akan dimuat otomatis dari Google Sheet -->
                <div class="col-span-full flex flex-col items-center justify-center py-20 text-neutral-400 dark:text-neutral-500 animate-pulse">
                     <p>Sedang mengambil data dari server...</p>
                </div>
            </div>
        </section>

        <!-- CTA -->
        <section class="py-24 max-w-4xl mx-auto px-4 text-center reveal">
            <h3 class="text-3xl font-bold text-neutral-900 dark:text-white mb-6">Punya Ide Menarik?</h3>
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                <a class="w-full sm:w-auto px-8 py-3 bg-red-600 hover:bg-red-700 text-white rounded-full font-medium transition-colors" href="contact.html">
                    Hubungi Kami
                </a>
            </div>
        </section>

    </main>

    <!-- Lightbox Modal -->
    <div id="lightbox" class="fixed inset-0 z-[1000] bg-black/95 hidden flex items-center justify-center opacity-0 transition-opacity duration-300">
        <!-- Close Button -->
        <button id="lightbox-close" class="absolute top-6 right-6 text-white/70 hover:text-white p-2 z-50">
            <i data-lucide="x" class="w-8 h-8"></i>
        </button>

        <!-- Navigation -->
        <button id="lightbox-prev" class="absolute left-4 md:left-8 text-white/70 hover:text-white p-4 z-50 hidden md:block">
            <i data-lucide="chevron-left" class="w-10 h-10"></i>
        </button>
        <button id="lightbox-next" class="absolute right-4 md:right-8 text-white/70 hover:text-white p-4 z-50 hidden md:block">
            <i data-lucide="chevron-right" class="w-10 h-10"></i>
        </button>

        <!-- Content Container -->
        <div class="relative w-full h-full max-w-6xl max-h-screen p-4 md:p-12 flex items-center justify-center">
            <img id="lightbox-img" src="" alt="Full view" class="max-w-full max-h-full object-contain shadow-2xl hidden" />
            <video id="lightbox-video" controls playsinline class="max-w-full max-h-full shadow-2xl hidden">
                <source src="" type="video/mp4">
                Browser Anda tidak mendukung tag video.
            </video>
        </div>
    </div>

    <!-- Theme Toggle -->
    <div class="fixed !bottom-6 !right-6 !z-[999]">
        <label class="theme-switch">
            <input type="checkbox" id="theme-toggle-checkbox">
            <span class="slider">
                <i data-lucide="sun" class="icon-sun"></i>
                <i data-lucide="moon" class="icon-moon"></i>
            </span>
        </label>
    </div>

    <!-- Footer Jitter Style -->
    <footer class="relative bg-white dark:bg-neutral-950 pt-24 pb-0 overflow-hidden border-t border-neutral-200 dark:border-neutral-800">
        <div class="max-w-7xl mx-auto px-6 lg:px-8 relative z-10">
            
            <!-- Top CTA Section -->
            <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-10 mb-20 border-b border-neutral-200 dark:border-neutral-800 pb-10">
                <div class="max-w-2xl">
                    <h2 class="text-5xl md:text-7xl font-bold tracking-tighter text-neutral-900 dark:text-white mb-6">
                        Siap mengabadikan <br> <span class="text-neutral-400">momen anda?</span>
                    </h2>
                    <p class="text-lg text-neutral-500 dark:text-neutral-400 max-w-md">
                        Kami membantu anda menciptakan visual yang tak lekang oleh waktu. Hubungi kami untuk konsultasi gratis.
                    </p>
                </div>
                <div>
                    <a href="contact.html" class="inline-flex items-center justify-center px-8 py-4 text-base font-medium text-white bg-neutral-900 dark:bg-white dark:text-neutral-900 rounded-full hover:bg-red-600 dark:hover:bg-red-600 dark:hover:text-white transition-all duration-300 group">
                        Mulai Sekarang
                        <i data-lucide="arrow-right" class="ml-2 w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                    </a>
                </div>
            </div>

            <!-- Links Grid -->
            <div class="grid grid-cols-2 md:grid-cols-3 gap-10 mb-20">
                <!-- Column 1 -->
                <div class="flex flex-col space-y-4">
                    <h4 class="font-semibold text-neutral-900 dark:text-white">Menu</h4>
                    <a href="index.html" class="text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Beranda</a>
                    <a href="services.html" class="text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Layanan</a>
                    <a href="gallery.html" class="text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Galeri</a>
                </div>

                <!-- Column 2 -->
                <div class="flex flex-col space-y-4">
                    <h4 class="font-semibold text-neutral-900 dark:text-white">Perusahaan</h4>
                    <a href="developer.html" class="text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Tentang Kami</a>
                    <a href="contact.html" class="text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Karir</a>
                </div>

                <!-- Column 3 -->
                <div class="flex flex-col space-y-4">
                    <h4 class="font-semibold text-neutral-900 dark:text-white">Sosial</h4>
                    <a href="https://instagram.com/timeless.projct" target="_blank" class="text-neutral-500 dark:text-neutral-400 hover:text-red-600 transition-colors">Instagram</a>
                </div>
            </div>

            <!-- Bottom Bar -->
            <div class="flex flex-col md:flex-row justify-between items-center pt-8 border-t border-neutral-200 dark:border-neutral-800 pb-24">
                <p class="text-sm text-neutral-500">© <span id="year"></span> Timeless Agency. All rights reserved.</p>
            </div>
        </div>

        <!-- Giant Text Background -->
        <div class="absolute bottom-0 left-0 w-full select-none pointer-events-none overflow-hidden leading-none">
            <h1 class="text-[18vw] font-bold text-center text-neutral-100 dark:text-neutral-900/50 tracking-tighter translate-y-[20%]">
                TIMELESS
            </h1>
        </div>
    </footer>

    <script defer src="assets/js/main.js"></script>

    <!-- Lenis Smooth Scroll -->
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
    
    <!-- 3D Tilt Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.7.0/vanilla-tilt.min.js"></script>

    <script>
        lucide.createIcons();
        document.getElementById('year').textContent = new Date().getFullYear();

        // --- 3D Tilt Effect for Gallery Items ---
        VanillaTilt.init(document.querySelectorAll(".gallery-item"), {
            max: 10,
            speed: 400,
            glare: true,
            "max-glare": 0.2,
            scale: 1.02
        });

        // --- Magnetic Buttons Effect ---
        const magneticBtns = document.querySelectorAll('.filter-btn, .btn, button:not(#nav-toggle):not(#theme-toggle)');
        magneticBtns.forEach(btn => {
            btn.addEventListener('mousemove', (e) => {
                const rect = btn.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;
                
                // Move the button slightly towards the cursor
                btn.style.transform = `translate(${x * 0.2}px, ${y * 0.2}px)`;
                btn.style.transition = 'transform 0.1s ease-out';
            });

            btn.addEventListener('mouseleave', () => {
                // Reset position
                btn.style.transform = 'translate(0, 0)';
                btn.style.transition = 'transform 0.3s ease-out';
            });
        });

        // Simple Mobile Menu Logic
        const navToggle = document.getElementById('nav-toggle');
        const mobileMenu = document.getElementById('mobile-menu-overlay');
        const menuCloseBtn = document.getElementById('menu-close-btn');
        
        if(navToggle && mobileMenu) {
            const toggleMenu = () => {
                const isOpen = mobileMenu.classList.contains('open');
                if (isOpen) {
                    mobileMenu.classList.remove('open');
                    navToggle.classList.remove('active');
                    document.body.style.overflow = ''; 
                } else {
                    mobileMenu.classList.add('open');
                    navToggle.classList.add('active');
                    document.body.style.overflow = 'hidden'; 
                }
            };

            navToggle.addEventListener('click', toggleMenu);
            if(menuCloseBtn) menuCloseBtn.addEventListener('click', toggleMenu);
            
            // Close menu when clicking a link
            const mobileLinks = mobileMenu.querySelectorAll('a');
            mobileLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault(); // Prevent immediate navigation
                    const targetUrl = link.getAttribute('href');
                    
                    // Close the menu
                    mobileMenu.classList.remove('open');
                    navToggle.classList.remove('active');
                    document.body.style.overflow = '';
                    
                    // Wait for animation to finish (1000ms)
                    setTimeout(() => {
                        window.location.href = targetUrl;
                    }, 1000);
                });
            });
        }



        // --- Dynamic Gallery Database & Logic ---

        // KONFIGURASI GOOGLE APPS SCRIPT WEB APP
        // Isi dengan URL Web App (Exec) yang Anda dapatkan setelah Deploy.
        // Format: https://script.google.com/macros/s/..../exec
        const GOOGLE_SHEET_URL = "https://script.google.com/macros/s/AKfycbyQ4ShlE_BqextqPKpHfz4oRK4OHTLaFBpM10baeJx4Ck2tu-F-NnGgdI-Mp2QhuPW8jw/exec"; 

        // Global State for Lightbox
        let galleryItemsList = []; 

        // Helper: Convert Google Drive Link to Direct Link
        function convertDriveLink(url, isVideo = false) {
            if (!url) return '';
            // Check if it's a google drive link
            if (url.includes('drive.google.com') || url.includes('docs.google.com')) {
                // Extract ID
                let id = '';
                const parts = url.match(/\/d\/(.+?)\//);
                if (parts && parts[1]) {
                    id = parts[1];
                } else {
                    const match = url.match(/id=([^&]+)/);
                    if(match && match[1]) id = match[1];
                }

                if (id) {
                    if (isVideo) {
                        // For Videos: Must use export=download or open
                        return `https://drive.google.com/uc?export=download&id=${id}`;
                    } else {
                        // For Images: lh3 is faster/better
                        return `https://lh3.googleusercontent.com/d/${id}`;
                    }
                }
            }
            return url;
        }

        async function loadGalleryDatabase() {
            const grid = document.getElementById('gallery-grid');
            
            if (!GOOGLE_SHEET_URL) {
                console.log("URL Apps Script belum diisi. Menampilkan konten demo.");
                initGalleryFeatures();
                return;
            }

            try {
                // Tambahkan Timestamp agar tidak dicache oleh browser
                // (Ini memaksa browser mengambil data terbaru terus)
                const noCacheUrl = GOOGLE_SHEET_URL + "?t=" + new Date().getTime();
                
                const response = await fetch(noCacheUrl);
                const rawData = await response.json();
                
                console.log('Data dari Sheet:', rawData); 

                if(rawData.length > 0) {
                    grid.innerHTML = ''; 
                    
                    rawData.forEach((row, index) => {
                        // Helper untuk membaca nama kolom meski huruf besar/kecil beda
                        const getVal = (key) => {
                            const foundKey = Object.keys(row).find(k => k.toLowerCase() === key.toLowerCase());
                            return foundKey ? row[foundKey] : '';
                        };

                        let title = getVal('Judul') || 'Timeless Work';
                        let type = 'image';
                        let category = 'fotografi';
                        let url = '';
                        let thumb = '';
                        
                        // Cek apakah pakai Format Lama (Kolom: File, Jenis, Kategori)
                        const oldFile = getVal('File');
                        if (oldFile) {
                            url = oldFile;
                            const oldType = getVal('Jenis').toLowerCase();
                            type = oldType.includes('video') ? 'video' : 'image';
                            category = getVal('Kategori').toLowerCase().replace(/\s/g, '') || 'fotografi';
                            thumb = getVal('Thumbnail');
                        } 
                        // Jika tidak, pakai Format Baru (Kolom: Foto, Video, Design Logo)
                        else {
                            const vidUrl = getVal('Video');
                            const desUrl = getVal('Design Logo');
                            const imgUrl = getVal('Foto');

                            if (vidUrl) {
                                type = 'video';
                                category = 'videografi';
                                url = vidUrl;
                                thumb = getVal('Thumbnail');
                            } else if (desUrl) {
                                type = 'image';
                                category = 'logo';
                                url = desUrl;
                            } else if (imgUrl) {
                                type = 'image';
                                category = 'fotografi';
                                url = imgUrl;
                            }
                        }

                        // Jika URL tidak ditemukan, skip
                        if (!url) return;

                        // Konversi Link Drive
                        url = convertDriveLink(url, type === 'video');
                        thumb = convertDriveLink(thumb, false);

                        const itemHTML = createItemHTML(type, category, url, thumb, title, index);
                        grid.insertAdjacentHTML('beforeend', itemHTML);
                    });

                    // Trigger Observasi untuk Animasi (Karena items baru di-add dynamic)
                    const observer = new IntersectionObserver((entries)=>{
                        entries.forEach(e=>{
                            if(e.isIntersecting){
                                requestAnimationFrame(() => {
                                    e.target.classList.add('is-visible');
                                });
                                observer.unobserve(e.target);
                            }
                        })
                    },{threshold: 0.1});
                    
                    document.querySelectorAll('#gallery-grid .reveal').forEach(el=>observer.observe(el));
                }
                
                grid.classList.remove('opacity-50');
                initGalleryFeatures();
                lucide.createIcons();

            } catch (err) {
                console.error('Error loading Google Sheet Data:', err);
                grid.classList.remove('opacity-50');
                // Tampilkan pesan error di layar agar user tahu
                const errDiv = document.createElement('div');
                errDiv.className = 'col-span-3 text-center text-red-500 py-10';
                errDiv.innerHTML = `<p>Gagal memuat data. Periksa Console Browser.</p><p class="text-sm mt-2 opacity-70">${err.message}</p>`;
                // grid.appendChild(errDiv); // Opsional: tampilkan error
                initGalleryFeatures(); 
            }
        }

        function createItemHTML(type, category, url, thumb, title, index) {
            if (type === 'video') {
                return `
                <a href="${url}" class="gallery-item group relative aspect-square overflow-hidden rounded-xl bg-neutral-100 dark:bg-neutral-800 reveal block cursor-zoom-in" data-type="video" data-category="${category}">
                    <video src="${url}" poster="${thumb}" muted playsinline loop class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"></video>
                    <div class="absolute inset-0 bg-black/20 group-hover:bg-black/40 transition-colors duration-300 flex items-center justify-center">
                        <div class="w-12 h-12 bg-white/30 backdrop-blur rounded-full flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                            <i data-lucide="play" class="h-5 w-5 text-white fill-white ml-1"></i>
                        </div>
                    </div>
                </a>`;
            } else {
                return `
                <a href="${url}" class="gallery-item group relative aspect-square overflow-hidden rounded-xl bg-neutral-100 dark:bg-neutral-800 reveal block cursor-zoom-in" data-type="image" data-category="${category}">
                    <img src="${url}" alt="${title}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" loading="lazy" />
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                        <div class="bg-white/90 dark:bg-neutral-900/90 backdrop-blur px-4 py-2 rounded-full text-sm font-medium text-neutral-900 dark:text-white shadow-lg transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                            Lihat Full
                        </div>
                    </div>
                </a>`;
            }
        }

        // --- Init Logic (Lightbox + Filter + Parallax) ---
        function initGalleryFeatures() {
            // Update global list
            galleryItemsList = Array.from(document.querySelectorAll('.gallery-item'));

            // 1. Lightbox Logic
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxVideo = document.getElementById('lightbox-video');
            const closeBtn = document.getElementById('lightbox-close');
            const prevBtn = document.getElementById('lightbox-prev');
            const nextBtn = document.getElementById('lightbox-next');
            
            let currentIndex = 0;

            function openLightbox(index) {
                currentIndex = index;
                const item = galleryItemsList[index];
                if(!item) return;

                const type = item.getAttribute('data-type');
                // For video, get src from video tag, for image get href
                let src = item.getAttribute('href'); 
                // Fallback if href is #
                if(!src || src === '#') {
                     if(type === 'video') src = item.querySelector('video').src;
                     else src = item.querySelector('img').src;
                }

                if (type === 'video') {
                    lightboxImg.classList.add('hidden');
                    lightboxVideo.classList.remove('hidden');
                    lightboxVideo.src = src;
                    lightboxVideo.play();
                } else {
                    lightboxVideo.classList.add('hidden');
                    lightboxVideo.pause();
                    lightboxImg.classList.remove('hidden');
                    lightboxImg.src = src;
                }

                lightbox.classList.remove('hidden');
                setTimeout(() => lightbox.classList.remove('opacity-0'), 10);
                document.body.classList.add('modal-open');
            }

            function closeLightbox() {
                lightbox.classList.add('opacity-0');
                setTimeout(() => {
                    lightbox.classList.add('hidden');
                    lightboxVideo.pause();
                    lightboxVideo.src = "";
                    lightboxImg.src = "";
                }, 300);
                document.body.classList.remove('modal-open');
            }

            function showNext() {
                // Find next visible item if filtering is active? 
                // For simplicity, cycle through ALL items or just visible ones.
                // Better UX: cycle through visible ones.
                
                // Let's filter only visible items first
                const visible = galleryItemsList.filter(item => !item.classList.contains('hidden'));
                const currentVisibleIndex = visible.indexOf(galleryItemsList[currentIndex]);
                
                // If current item is hidden (e.g. filter changed while lightbox open), reset
                if (currentVisibleIndex === -1) {
                    closeLightbox();
                    return;
                }

                const nextIndex = (currentVisibleIndex + 1) % visible.length;
                // Find true index in main list
                const nextItem = visible[nextIndex];
                const trueIndex = galleryItemsList.indexOf(nextItem);
                
                openLightbox(trueIndex);
            }

            function showPrev() {
                const visible = galleryItemsList.filter(item => !item.classList.contains('hidden'));
                const currentVisibleIndex = visible.indexOf(galleryItemsList[currentIndex]);
                
                if (currentVisibleIndex === -1) {
                    closeLightbox();
                    return;
                }

                const prevIndex = (currentVisibleIndex - 1 + visible.length) % visible.length;
                const prevItem = visible[prevIndex];
                const trueIndex = galleryItemsList.indexOf(prevItem);
                
                openLightbox(trueIndex);
            }

            // Bind Events (Remove old listeners first cloneNode? No, just add new ones, duplicates unlikely on reload of page)
            galleryItemsList.forEach((item, index) => {
                // Remove existing listener by clone (brute force) or just add. 
                // Since this runs once on init (or after db load), simple add is fine.
                item.onclick = (e) => {
                    e.preventDefault();
                    openLightbox(index);
                };
            });

            // Re-bind controls (ensure not duplicated if fun called twice)
            closeBtn.onclick = closeLightbox;
            nextBtn.onclick = (e) => { e.stopPropagation(); showNext(); };
            prevBtn.onclick = (e) => { e.stopPropagation(); showPrev(); };
            lightbox.onclick = (e) => {
                if (e.target === lightbox) closeLightbox();
            };
            
            // 2. Filter & Parallax Logic
            const filterBtns = document.querySelectorAll('.filter-btn');
            
            function updateParallax() {
                const scrollY = window.scrollY;
                if (window.innerWidth < 640) {
                    galleryItemsList.forEach(item => item.style.transform = 'none');
                    return;
                }
                const visibleItems = galleryItemsList.filter(item => !item.classList.contains('hidden'));
                
                // 3 Cols for lg, 2 for sm
                let columns = window.innerWidth >= 1024 ? 3 : 2; 

                visibleItems.forEach((item, index) => {
                    const colIndex = index % columns;
                    if (colIndex % 2 !== 0) {
                        item.style.transform = `translateY(${scrollY * 0.08}px)`;
                    } else {
                        item.style.transform = 'none';
                    }
                });
            }

            // Bind Filter Buttons
            filterBtns.forEach(btn => {
                btn.onclick = () => {
                    filterBtns.forEach(b => {
                        b.classList.remove('bg-red-600', 'text-white', 'border-red-600');
                        b.classList.add('text-neutral-600', 'dark:text-neutral-400', 'border-neutral-200', 'dark:border-neutral-800');
                    });
                    btn.classList.remove('text-neutral-600', 'dark:text-neutral-400', 'border-neutral-200', 'dark:border-neutral-800');
                    btn.classList.add('bg-red-600', 'text-white', 'border-red-600');

                    const filterValue = btn.getAttribute('data-filter');
                    
                    galleryItemsList.forEach(item => {
                        if (filterValue === 'all' || item.getAttribute('data-category') === filterValue) {
                            item.classList.remove('hidden');
                            item.classList.add('block', 'animate-fade-in');
                        } else {
                            item.classList.add('hidden');
                            item.classList.remove('block', 'animate-fade-in');
                            item.style.transform = 'none';
                        }
                    });

                    setTimeout(updateParallax, 50);
                };
            });

            // Parallax Scroll Listener
            window.removeEventListener('scroll', updateParallax); // Clean old
            window.addEventListener('scroll', updateParallax);
            if (typeof lenis !== 'undefined') lenis.on('scroll', updateParallax);
            
            updateParallax();
            
            // Re-init Tilt
            if(window.VanillaTilt) {
                try {
                // Destroy old instance if exists to prevent memory leak? VanillaTilt auto-checks.
                VanillaTilt.init(galleryItemsList, {
                    max: 10, speed: 400, glare: true, "max-glare": 0.2, scale: 1.02
                });
                } catch(e){}
            }
        }

        // Keyboard Nav
        document.onkeydown = (e) => {
           const lightbox = document.getElementById('lightbox');
           if (!lightbox || lightbox.classList.contains('hidden')) return;
           if (e.key === 'Escape') document.getElementById('lightbox-close').click();
           if (e.key === 'ArrowRight') document.getElementById('lightbox-next').click();
           if (e.key === 'ArrowLeft') document.getElementById('lightbox-prev').click();
        };

        // Start
        loadGalleryDatabase();


    </script>
</body>
</html>